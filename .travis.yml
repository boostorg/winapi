sudo: true
language: cpp
compiler:
    - gcc
#    - clang

os:
    - linux

env:
    global:
        # Autodetect Boost branch by using the following code: - BRANCH_TO_TEST=$TRAVIS_BRANCH
        # or just directly specify it
        - BRANCH_TO_TEST=$TRAVIS_BRANCH

        # Explicitly remove the following library from Boost. This may be usefull, if you're for example running Travis
        # from `Boost.DLL` repo, while Boost already has `dll`.
        #
        # By default is eaual to - BOOST_REMOVE=`basename $TRAVIS_BUILD_DIR`
        # This will force to use local repo content, instead of the Boost's default
        - BOOST_REMOVE=winapi
        -

    matrix:
        - TOOLSET=gcc-w32 
        - TOOLSET=gcc-w64 


addons:
    apt:
      sources:
      - ubuntu-toolchain-r-test apt:
      packages:
      - gcc-mingw-w64
      - g++-mingw-w64
      - gcc-mingw-w64-i686
      - gcc-mingw-w64-x86-64
      - g++-mingw-w64-i686
      - g++-mingw-w64-x86-64
      - binutils-mingw-w64-i686
      - binutils-mingw-w64-x86-64
      - mingw-w64
      - mingw-w64-dev
      - gcc-mingw-w64-base
      - gcc

###############################################################################################################
# From this point and below code is same for all the Boost libs
###############################################################################################################

before_script:
   # Set this to the name of the library
  - PROJECT_TO_TEST=`basename $TRAVIS_BUILD_DIR`
  - echo "Testing $PROJECT_TO_TEST"
  # Cloning Boost libraries (fast nondeep cloning)
  - BOOST=$HOME/boost-local
  - git init $BOOST
  - cd $BOOST
  - git remote add --no-tags -t $BRANCH_TO_TEST origin https://github.com/boostorg/boost.git
  - git fetch --depth=1
  - git checkout $BRANCH_TO_TEST
  - git submodule update --init --merge
  - git remote set-branches --add origin $BRANCH_TO_TEST
  - git pull --recurse-submodules
  - git submodule update --init
  - git checkout $BRANCH_TO_TEST
  - git submodule foreach "git reset --quiet --hard; git clean -fxd"
  - git reset --hard; git clean -fxd
  - git status
  - rm -rf $BOOST/libs/$BOOST_REMOVE
  - mv $TRAVIS_BUILD_DIR/../$PROJECT_TO_TEST/ $BOOST/libs/$PROJECT_TO_TEST
  - TRAVIS_BUILD_DIR=$BOOST/libs/$PROJECT_TO_TEST
  - ./bootstrap.sh
  - ./b2 headers
  - cd $BOOST/libs/$PROJECT_TO_TEST/test
  - cp travis.jam user-config.jam
script:
  - ../../../b2 toolset=$TOOLSET target-os=windows -sBOOST_BUILD_PATH=.
